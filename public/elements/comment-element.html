<link rel="import" href="/platform/bower_components/core-ajax/core-xhr.html">
<link rel="import" href="/platform/bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="/platform/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/platform/elements/member-select/member-element.html">
<link rel="import" href="/platform/elements/smart-editor/smart-display.html">

<polymer-element name="comment-element" attributes="cid time user body input">
    <template>
        <style>
            member-element /deep/ .element > div {
                width: 100%;
            }
            member-element /deep/ .element > div div:not(.title) {
                margin-top: -12px;
            }
            member-element /deep/ .element > div div span {
                font-size: medium;
                font-weight: bold;
            }
            .time {
                display: inline-block;
                padding-top: 0.2em;
                font-size: small;
                color: #888;
            }
            .content {
                padding: 0 5px;
            }
            .butt {
                color: #ddd;
                padding: 2px;
                margin-left: 8px;
            }
            .butt::shadow #ripple {
                color: black;
            }
            #wrapper {
                border-bottom: 1px solid #ddd;
                margin-bottom: 1em;
            }
        </style>

        <div id="wrapper">
            <member-element username={{user}} imagesize=36 view="custom">
                <div class="title">
                    <core-tooltip label={{timeTip}}>
                        <span class="time">&middot;{{timeTag}}</span>
                    </core-tooltip>
                </div>
                <div relative class="content">
                    <div>
                        <smart-display value="{{body}}" class="p"></smart-display>
                        <core-tooltip label="Delete" style="float: right">
                            <paper-icon-button icon="close" class="butt" on-tap="{{deleteComment}}"></paper-icon-button>
                        </core-tooltip>
                        <core-tooltip label="Reply" style="float: right">
                            <paper-icon-button icon="reply" class="butt" on-tap="{{startReply}}"></paper-icon-button>
                        </core-tooltip>
                    </div>
                </div>
            </member-element>
        </div>

        <core-xhr id="xhr"></core-xhr>
    </template>

    <script>
        Polymer({
            startReply: function() {
                this.input.focus();
                this.input.value = "@" + this.user + " ";
            },
            deleteComment: function() {
                this.$.xhr.request({
                    url: "/comment/comment/" + this.cid,
                    method: "DELETE"
                });
            },
            timeChanged: function() {
                var s = new Date(parseInt(this.time)).toString();
                this.timeTip = s.substr(0, 24);
                this.timeTag = s.substr(16, 5) + s.substr(3, 7);
            }
        })
    </script>
</polymer-element>
