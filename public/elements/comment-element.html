<link rel="import" href="/platform/bower_components/core-ajax/core-xhr.html">
<link rel="import" href="/platform/bower_components/core-tooltip/core-tooltip.html">
<link rel="import" href="/platform/bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="/platform/elements/member-select/member-element.html">
<link rel="import" href="/platform/elements/smart-editor/smart-display.html">

<polymer-element name="comment-element" attributes="cid time user body input">
    <template>
        <style>
            .time {
                font-size: small;
                color: #888;
            }
            .p {
                margin: 4px 0;
                font-size: small;
            }
            .butt {
                color: #ddd;
                padding: 2px;
                margin-left: 8px;
            }
            .butt::shadow #ripple {
                color: black;
            }
        </style>

        <member-element userid={{user}} imagesize=36 view="custom">
            <div class="title">
                <core-tooltip label={{timeTip}}>
                    <span class="time">&middot;{{timeTag}}</span>
                </core-tooltip>
            </div>
            <div class="content">
                <div>
                    <smart-display value="{{body}}" class="p"></smart-display> 
                </div>
                <div style="float: right">
                    <core-tooltip label="Reply">
                        <paper-icon-button icon="reply" class="butt" on-tap="{{startReply}}"></paper-icon-button>
                    </core-tooltip>
                    <core-tooltip label="Delete">
                        <paper-icon-button icon="delete" class="butt" on-tap="{{deleteComment}}"></paper-icon-button>
                    </core-tooltip>
                </div>
            </div>
        </member-element>

        <core-xhr id="xhr"></core-xhr>
    </template>

    <script>
        Polymer({
            ready: function() {
                var s = new Date(parseInt(this.time)).toString();
                this.timeTip = s.substr(0, 24);
                this.timeTag = s.substr(16, 5) + s.substr(3, 7);
            },
            startReply: function() {
                this.input.focus();
                this.input.value = "@" + this.user + " ";
            },
            deleteComment: function() {
                this.$.xhr.request({
                    url: "/comment/" + this.cid,
                    method: "DELETE"
                });
            },
            timeChanged: function() {
                this.ready();
            }
        })
    </script>
</polymer-element>
